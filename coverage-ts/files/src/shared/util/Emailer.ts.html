
  <!DOCTYPE html>
  <html>
    <head>
      <title>Emailer.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/shared/util/Emailer.ts</td><td class="">98.73%</td><td class="">80%</td><td class="">79</td><td class="">78</td><td class="">1</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import Account from &#x27;@entities/Account&#x27;;
import logger from &#x27;@shared/Logger&#x27;;
import { ObjectId } from &#x27;mongodb&#x27;;
import nodemailer from &#x27;nodemailer&#x27;;
import fs from &#x27;fs&#x27;;
import path from &#x27;path&#x27;;

const NODEMAILER_SERVICE = process.env.NODEMAILER_SERVICE;
const NODEMAILER_USER = process.env.NODEMAILER_USER;
const NODEMAILER_PASS = process.env.NODEMAILER_PASS;

const transporter = nodemailer.createTransport({
    service: NODEMAILER_SERVICE,
    auth: {
        user: NODEMAILER_USER,
        pass: NODEMAILER_PASS,
    },
});

export class VerifyEmailer {
    public user: ObjectId;

    public constructor(user: ObjectId) {
        this.user = user;
    }

    public sendVerifyEmail(tokenString: string): void {
        Account.loadFromDatabaseById(this.user, (account) =&gt; {
            if (account &amp;&amp; account.email) {
                let html = fs.readFileSync(
                    path.join(
                        process.cwd(),
                        &#x27;email_templates/verifyEmail.html&#x27;
                    ),
                    &#x27;utf-8&#x27;
                );

                while (html.indexOf(&#x27;${verifylink}&#x27;) &gt;= 0)
                    html = html.replace(&#x27;${verifylink}&#x27;, tokenString);

                const emailInfo = {
                    from: &#x27;Viraj Shah at Resumator&#x27;,
                    to: account.email,
                    subject: &#x27;Please Verify Your Email&#x27;,
                    html,
                };

                transporter.sendMail(emailInfo, (err, info) =&gt; {
                    if (err) {
                        logger.error(err);
                    } else {
                        logger.info(
                            `Verification email sent to ${account.email}`
                        );
                    }
                });
            }
        });
    }
}
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/shared/util/Emailer.ts&quot;,&quot;line&quot;:47,&quot;character&quot;:54,&quot;text&quot;:&quot;info&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Tue, 29 Dec 2020 07:34:25 GMT</p>
    </body>
  </html>
  